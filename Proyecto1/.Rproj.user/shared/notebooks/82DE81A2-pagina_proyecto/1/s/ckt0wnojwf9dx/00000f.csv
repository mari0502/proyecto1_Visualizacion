"0",""
"0","library(stringdist)"
"0","library(ggplot2)"
"0","library(lubridate)"
"0","library(scales)"
"0","library(RColorBrewer)"
"0","library(""rstudioapi"")    "
"0","library(patchwork)"
"0","library(tidyverse)"
"0","library(plotly)"
"0","library(ggiraph)"
"0","library(patchwork)"
"0",""
"0","setwd(dirname(getActiveDocumentContext()$path))"
"0",""
"0","data <- read.csv(""Uso_Transporte_MAYO_2018-JUNIO_2020.csv"", header = FALSE, sep = "";"", stringsAsFactors = FALSE, skip =2, fileEncoding = ""ISO-8859-1"")"
"0",""
"0","# Split each row based on multiple semicolons (;;)"
"0","data <- data %>%"
"0","  mutate(row_data = strsplit(as.character(V1), "";;"")) %>%"
"0","  unnest(row_data) %>%"
"0","  mutate(row_data = strsplit(row_data, "";"")) %>%"
"0","  unnest(row_data)"
"0","# Separate the row_data into separate columns"
"0","data <- data %>%"
"0","  separate(row_data, into = paste0(""Category"", 1:9), sep = "";"", fill=""right"")"
"0","# Remove the first and last columns"
"0","data <- data %>%"
"0","  select(-1, -ncol(data)) %>%"
"0","  select(where(~ any(!is.na(.))))"
"0","# Remove the 10th column"
"0","data <- data[, -10]"
"0","# Get the names from the first row"
"0","new_names <- unlist(data[1, ])"
"0","# Rename the columns"
"0","data <- setNames(data, new_names)"
"0","# Filter rows based on conditions using if_any and if_all"
"0","data <- data %>%"
"0","  filter(if_any(everything(), ~ !(.x %in% names(data))),"
"0","         if_all(everything(), ~ !(.x == ""?"")))"
"0","# Remove ""?"" from all strings in the data frame"
"0","data <- data %>% mutate(across(everything(), ~str_replace_all(., ""[-|!?]"", "" "")))"
"0","data <- data %>% mutate(across(everything(), ~str_replace_all(., ""[,]"", """")))"
"0","# Remove trailing spaces using if_any and if_all"
"0","data <- data %>%"
"0","  mutate(across(where(~any(str_detect(., ""\\s""))), str_trim), "
"0","         across(where(~all(str_detect(., ""\\s""))), str_trim))"
"0","# Capitalize"
"0","data <- data %>%"
"0","  mutate(across(everything(), toupper))"
"0","# Function to replace accent marks"
"0","remove_accents <- function(string) {"
"0","  chartr(""áéíóúüñÁÉÍÓÚÜ"", ""aeiouunAEIOUU"", string)"
"0","}"
"0","# Apply the function to all columns"
"0","data <- data %>%"
"0","  mutate(across(everything(), remove_accents))"
"0","# Normalize strings by removing diacritics (accent marks)"
"0","normalize_string <- function(string) {"
"0","  return(stri_trans_general(string, ""Latin-ASCII""))"
"0","}"
"0",""
"0","# Convert to numeric"
"0","data$`TOTAL KM` <- as.numeric(as.character(data$`TOTAL KM`))"
"0","data$COMBUSTIBLE <- as.numeric(as.character(data$COMBUSTIBLE))"
"0",""
"0","#--------------------------------------------------------------------------------#"
"0",""
"0","# List of words for grouping"
"0","Provincias <- c(""SAN JOSE"", ""GUANACASTE"", ""PUNTARENAS"", ""LIMON"" , ""CARTAGO"" ,""HEREDIA"", ""ALAJUELA"")"
"0",""
"0","Cantones <- c(""SAN JOSE"", ""SAN MARCOS"", ""SAN RAMON"", ""LIMON"", ""SARAQUIQUI"", ""MORA"", ""SANTA CRUZ"", ""LIBERIA"", "
"0","              ""NICOYA"", ""ALAJUELA"", ""SAN RAFAEL"", ""SAN ISIDRO"", ""NARANJO"", ""QUESADA"", ""PALMARES"", ""PUNTARENAS"", ""GUACIMO"", "
"0","              ""SANTO DOMINGO"", ""COTO BRUS"", ""MATINA"", ""GUAPILES"", ""CARIARI"", ""DESAMPARADOS"", ""LA URUCA"", ""SIQUIRRES"", ""SAN VICENTE"", "
"0","              ""BUENOS AIRES"", ""POAS"", ""CURRIDABAT"", ""ESPARZA"", ""SAN PABLO"", ""PURRAL"", ""TURRIALBA"", ""CANAS"", ""DESAMPARADOS"", ""SAN JUAN"", "
"0","              ""HORQUETAS"", ""RITA"", ""SAN PEDRO"", ""SAN RAFAEL ABAJO"", ""CARTAGO"", ""GUADALUPE"", ""SAN ISIDRO"", ""PARAISO"", ""SARTALILLO"", "
"0","              ""AGUAS ZARCAS"", ""SAN FRANCISCO"", ""PUERTO VIEJO"", ""GUACIMA"", ""QUEPOS"", ""BAGACES"", ""SAN JUAN DE DIOS"", ""HEREDIA"", ""ZAPOTE"", "
"0","              ""ABANGARITOS"", ""COLON"", ""PITAL"", ""ROXANA"", ""SAN ISIDRO"", ""BATAN"", ""UPALA"", ""PARRITA"", ""POZOS"", ""FORTUNA"", ""SAN RAFAEL ARRIBA"", "
"0","              ""FLORENCIA"", ""SARDINAL"", ""GRECIA"", ""SAN VITO"", ""COPALCHI"", ""LOS CHILES"", ""SANTA ANA"", ""MATINILLA"", ""PUERTO JIMENEZ"", ""SANTIAGO"", "
"0","              ""ALAJUELITA"", ""ESCAZU"", ""PATARRA"", ""SIXAOLA"", ""JACO"", ""SAN JOSECITO"", ""GOLFITO"", ""NANDAYURE"", ""RIO CUARTO"", ""SABALITO"", ""RIO SEGUNDO"", "
"0","              ""PUENTE DE PIEDRA"", ""LA VIRGEN"", ""SAN JOSECITO"", ""JIMENEZ"", ""SAN MARCOS"", ""SAN ANTONIO"", ""DULCE NOMBRE DE JESUS"", ""OROTINA"", ""CANOAS"", "
"0","              ""TRES RIOS"", ""CARRILLOS"", ""SAN IGNACIO"", ""PIEDADES NORTE"", ""PIEDADES"", ""TACARES"", ""DULCE NOMBRE"", ""TURRUCARES"", ""SAN PEDRO"", ""ATENAS"", "
"0","              ""BUENOS AIRES"", ""SANTA LUCIA"", ""BRIBRI"", ""SARCHI"", ""SAN RAFAEL"", ""TOBOSI"", ""JUAN VINAS"", ""VUELTA DE JORCO"", ""GENERAL VIEJO"", ""SAN JUAN GRANDE"", "
"0","              ""SAN JERONIMO"", ""AQUIARES"", ""SAN GABRIEL"", ""CINCO ESQUINAS"", ""COYOLAR"", ""PACAYAS"", ""SAN JOSE DE LA MONTANA"", ""QUEBRADILLAS"", ""SARCHI SUR"", "
"0","              ""TIERRA BLANCA"", ""BARVA"", ""TUCURRIQUE"", ""MACACONA"", ""SAN PABLO"", ""SAN MIGUEL OESTE"", ""CIRRI"", ""ZARCERO"", ""LLANO GRANDE"", ""SALITRAL"", ""SAN CRISTOBAL SUR"", "
"0","              ""SAN ANTONIO"", ""FRAILES"", ""CIPRESES"", ""SAN JERONIMO"", ""MATA DE PLATANO"", ""SAN CARLOS"", ""SABANA"", ""PEREZ ZELEDON"", ""GUANACASTE"", ""CIUDAD NEILY"", ""POCOCI"", ""PAVAS"""
"0",")"
"0",""
"0","Instituciones <- c(""TEATRO NACIONAL"", ""AEROPUERTO"", ""AREA METROPOLITANA"", ""ASAMBLEA LEGISLATIVA"", ""BANCO"", ""CANAL 7"", ""CASA PRESIDENCIAL|PRESIDENCIA DE LA REPUBLICA"", "
"0","                   ""CCSS"", ""CENTRO DE CONVENCIONES"", ""CLUB UNION"", ""COLEGIO DE ABOGADOS"", ""COLEGIO DE INGENIEROS"", ""CONTRALORIA"", ""COUNTRY CLUB"", ""CRHOY"", "
"0","                   ""DEFENSORIA DE LOS HABITANTES"", ""DIARIO EXTRA"", ""DINADECO"", ""IMAS"", ""EMBAJADA"", ""HOTEL"", ""ICE"", ""ICODER"", ""INCOFER"", ""ICT"", ""INA"", ""INDER"", ""INS"",""ACUEDUCTOS Y ALCANTARILLADOS|AYA|A Y A"", "
"0","                   ""MINISTERIO DE EDUCACION|MEP"", ""ESTADIO NACIONAL"", ""FISCALIA GENERAL"",""MINISTERIO DE HACIENDA"", ""MINISTERIO DE OBRAS PUBLICAS|MOPT"", ""MINISTERIO DE TRABAJO"", ""MINISTERIO DE AMBIENTE"", ""MINISTERIO DE SALUD"", "
"0","                   ""MUNICIPALIDAD"", ""MINISTERIO DE AGRICULTURA Y GANADERIA|MINISTERIO AGRICULTURA Y GANADERIA"", ""MINISTERIO DE SEGURIDAD"",""MINISTERIO DE ECONOMIA"", ""COOPEANDE"", ""INFOCOOP"",""RADIO"", ""REGISTRO NACIONAL"", "
"0","                   ""SALA CONSTITUCIONAL"", ""TEATRO NACIONAL"", ""UNIVERSIDAD"""
"0",")"
"0",""
"0","Destino_Mix <- c(Cantones,Instituciones)"
"0",""
"0","#--------------------------------------------------------------------------------#"
"0","# Function to check if any word in group_words is present in the value"
"0","group_destinations_cantones <- function(value) {"
"0","  matched_words <- Destino_Mix[sapply(Destino_Mix, function(word) grepl(word, value, ignore.case = TRUE))]"
"0","  if (length(matched_words) > 0) {"
"0","    return(matched_words[1])  # Return the first matched word as the group"
"0","  } else {"
"0","    return(""Other"")  # Return ""Other"" if no match found"
"0","  }"
"0","}"
"0",""
"0","# Apply the function to create a new column for grouping"
"0","data <- data %>%"
"0","  mutate(Destino_Group = sapply(DESTINO, group_destinations_cantones))"
"0",""
"0","# Create a summary dataframe with counts of each group"
"0","group_counts <- data %>%"
"0","  group_by(Destino_Group) %>%"
"0","  summarise(count = n())"
"0",""
"0","#--------------------------------------------------------------------------------#"
"0",""
